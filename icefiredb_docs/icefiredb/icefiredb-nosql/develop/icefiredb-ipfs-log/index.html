<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="icefiredb-ipfs-log # Project introduction # icefiredb-ipfs-log is a distributed immutable, operation-based conflict-free replication data structure that relies on ipfs to store data and merges each peer node data based on pubsub conflict-free. You can easily implement custom data structures such as kv, event, nosql, etc. based on icefiredb-ipfs-log.
Conflict-free log replication model
Log A Log B | | logA.append(&#34;one&#34;) logB.append(&#34;hello&#34;) | | v v +-----+ +-------+ |&#34;one&#34;| |&#34;hello&#34;| +-----+ +-------+ | | logA."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:type" content="website"><meta property="og:image" content="https://res.cloudinary.com/malloc/image/upload/v1666510486/icefiredb/logo_z8koem.png"><meta property="og:title" content="icefiredb-ipfs-log"><meta property="og:description" content="icefiredb-ipfs-log # Project introduction # icefiredb-ipfs-log is a distributed immutable, operation-based conflict-free replication data structure that relies on ipfs to store data and merges each peer node data based on pubsub conflict-free. You can easily implement custom data structures such as kv, event, nosql, etc. based on icefiredb-ipfs-log.
Conflict-free log replication model
Log A Log B | | logA.append(&#34;one&#34;) logB.append(&#34;hello&#34;) | | v v +-----+ +-------+ |&#34;one&#34;| |&#34;hello&#34;| +-----+ +-------+ | | logA."><meta property="og:type" content="article"><meta property="og:url" content="https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/develop/icefiredb-ipfs-log/"><meta property="article:section" content="IceFireDB"><title>icefiredb-ipfs-log | IceFireDB Documentation</title><link rel=manifest href=/icefiredb_docs/manifest.json><link rel=icon href=/icefiredb_docs/favicon.ico type=image/x-icon><link rel=stylesheet href=/icefiredb_docs/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous><script defer src=/icefiredb_docs/flexsearch.min.js></script>
<script defer src=/icefiredb_docs/en.search.min.6d1e8664bf52aa061ff8f52ed8fbf0924b12a5f8743d1947e84f3bccf6f340f7.js integrity="sha256-bR6GZL9SqgYf+PUu2PvwkksSpfh0PRlH6E87zPbzQPc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/icefiredb_docs/><span>IceFireDB Documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://www.icefiredb.xyz/ target=_blank rel=noopener>Official Site</a></li><li><a href=https://github.com/icefiredb target=_blank rel=noopener>Open Source</a></li></ul><ul><li class=book-section-flat><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/>Overview</a><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/engine_overview/>Engine Overview</a><ul></ul></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/vocabulary/>Vocabulary</a><ul></ul></li><li><span>IceFireDB-NoSQL</span><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/quick_start/>Quick Start</a><ul></ul></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/designs/>Designs</a><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/designs/network/>Network layer</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/designs/storage/>Storage layer</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/designs/protocol/>Protocol layer</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/designs/codec/>Codec layer</a></li></ul></li><li><span>Develop</span><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/develop/icefiredb-crdt-kv/>icefiredb-crdt-kv</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/develop/icefiredb-ipfs-log/ class=active>icefiredb-ipfs-log</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/develop/icefiredb_proxy/>icefiredb-proxy</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/develop/redhub/>redhub-frame</a></li></ul></li><li><span>Project Comparison</span><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/project-comparison/orbitdb/>OrbitDB</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-nosql/project-comparison/threaddb/>ThreadDB</a></li></ul></li></ul></li><li><span>IceFireDB-SQLite</span><ul><li><input type=checkbox id=section-9a14413c81006dc1ffda9fa39f8e6bac class=toggle>
<label for=section-9a14413c81006dc1ffda9fa39f8e6bac class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlite/architecture/overview/>OverView</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlite/architecture/network/>NetWork</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlite/architecture/storage/>Storage</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlite/architecture/protocol/>Protocol</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlite/architecture/codec/>Codec</a></li></ul></li></ul></li><li><span>IceFireDB-Redis-Proxy</span><ul><li><input type=checkbox id=section-3bf1c87fb952709c4563285ca0f995a6 class=toggle>
<label for=section-3bf1c87fb952709c4563285ca0f995a6 class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-redis-proxy/architecture/overview/>OverView</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-redis-proxy/architecture/network/>NetWork</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-redis-proxy/architecture/storage/>Storage</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-redis-proxy/architecture/protocol/>Protocol</a></li></ul></li></ul></li><li><span>IceFireDB-SQLProxy</span><ul><li><input type=checkbox id=section-fffdb9e9ea7862273e9c9ce0d60c9801 class=toggle>
<label for=section-fffdb9e9ea7862273e9c9ce0d60c9801 class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlproxy/architecture/overview/>OverView</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlproxy/architecture/network/>NetWork</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlproxy/architecture/storage/>Storage</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-sqlproxy/architecture/protocol/>Protocol</a></li></ul></li></ul></li><li><span>IceFireDB-PubSub</span><ul><li><input type=checkbox id=section-ef1f7256f510a0aabdfc342eef0e3348 class=toggle>
<label for=section-ef1f7256f510a0aabdfc342eef0e3348 class="flex justify-between"><a role=button>Architecture</a></label><ul><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-pubsub/architecture/overview/>OverView</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-pubsub/architecture/network/>NetWork</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-pubsub/architecture/storage/>Storage</a></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/icefiredb-pubsub/architecture/protocol/>Protocol</a></li></ul></li></ul></li><li><a href=https://www.icefiredb.xyz/icefiredb_docs/icefiredb/faqs/>FAQs</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/icefiredb_docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>icefiredb-ipfs-log</strong>
<label for=toc-control><img src=/icefiredb_docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#project-introduction>Project introduction</a></li><li><a href=#features>Features</a></li><li><a href=#installing>Installing</a></li><li><a href=#example>Example</a><ul><li><a href=#example-of-building-a-key-value-database-using-icefiredb-ipfs-log>Example of building a key-value database using icefiredb-ipfs-log</a></li><li><a href=#use-of-key-value-databases>Use of key-value databases</a></li></ul></li><li><a href=#some-code-reference-sources>Some code reference sources</a></li><li><a href=#license>License</a></li></ul></nav></aside></header><article class=markdown><h1 id=icefiredb-ipfs-log>icefiredb-ipfs-log
<a class=anchor href=#icefiredb-ipfs-log>#</a></h1><h2 id=project-introduction>Project introduction
<a class=anchor href=#project-introduction>#</a></h2><p>icefiredb-ipfs-log is a distributed immutable, operation-based conflict-free replication data structure that relies on ipfs to store data and merges each peer node data based on pubsub conflict-free. You can easily implement custom data structures such as kv, event, nosql, etc. based on icefiredb-ipfs-log.</p><p><strong>Conflict-free log replication model</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>           Log A                Log B
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>     logA.append<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;one&#34;</span><span style=color:#f92672>)</span>   logB.append<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hello&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>             v                    v
</span></span><span style=display:flex><span>          +-----+             +-------+
</span></span><span style=display:flex><span>          |<span style=color:#e6db74>&#34;one&#34;</span>|             |<span style=color:#e6db74>&#34;hello&#34;</span>|
</span></span><span style=display:flex><span>          +-----+             +-------+
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>     logA.append<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;two&#34;</span><span style=color:#f92672>)</span>   logB.append<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;world&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>             v                    v
</span></span><span style=display:flex><span>       +-----------+       +---------------+
</span></span><span style=display:flex><span>       |<span style=color:#e6db74>&#34;one&#34;</span>,<span style=color:#e6db74>&#34;two&#34;</span>|       |<span style=color:#e6db74>&#34;hello&#34;</span>,<span style=color:#e6db74>&#34;world&#34;</span>|
</span></span><span style=display:flex><span>       +-----------+       +---------------+
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>             |                    |
</span></span><span style=display:flex><span>       logA.join<span style=color:#f92672>(</span>logB<span style=color:#f92672>)</span> &lt;----------+
</span></span><span style=display:flex><span>             |
</span></span><span style=display:flex><span>             v
</span></span><span style=display:flex><span>+---------------------------+
</span></span><span style=display:flex><span>|<span style=color:#e6db74>&#34;one&#34;</span>,<span style=color:#e6db74>&#34;hello&#34;</span>,<span style=color:#e6db74>&#34;two&#34;</span>,<span style=color:#e6db74>&#34;world&#34;</span>|
</span></span><span style=display:flex><span>+---------------------------+
</span></span></code></pre></div><h2 id=features>Features
<a class=anchor href=#features>#</a></h2><ol><li>Easy access to P2P && ipfs-log data consistency function</li><li>Stable decentralized networking function</li><li>Friendly program access interface</li></ol><h2 id=installing>Installing
<a class=anchor href=#installing>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>get</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>u</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>IceFireDB</span><span style=color:#f92672>/</span><span style=color:#a6e22e>icefiredb</span><span style=color:#f92672>-</span><span style=color:#a6e22e>ipfs</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log</span>
</span></span></code></pre></div><h2 id=example>Example
<a class=anchor href=#example>#</a></h2><h3 id=example-of-building-a-key-value-database-using-icefiredb-ipfs-log>Example of building a key-value database using icefiredb-ipfs-log
<a class=anchor href=#example-of-building-a-key-value-database-using-icefiredb-ipfs-log>#</a></h3><ul><li>memory key-value：<a href=https://github.com/IceFireDB/icefiredb-ipfs-log/blob/main/stores/kv/db.go>memory-kv</a></li><li>leveldb kv ：<a href=https://github.com/IceFireDB/icefiredb-ipfs-log/blob/main/stores/levelkv/db.go>leveldb-kv</a></li></ul><h3 id=use-of-key-value-databases>Use of key-value databases
<a class=anchor href=#use-of-key-value-databases>#</a></h3><p><a href=https://github.com/IceFireDB/icefiredb-ipfs-log/tree/main/example>Detailed usage example reference</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>()
</span></span><span style=display:flex><span>    <span style=color:#75715e>// disk cache directory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>rootPath</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;./kvdb&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>node</span>, <span style=color:#a6e22e>api</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>iflog</span>.<span style=color:#a6e22e>CreateNode</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>rootPath</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hostAddr</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ma</span>.<span style=color:#a6e22e>NewMultiaddr</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;/ipfs/%s&#34;</span>, <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>PeerHost</span>.<span style=color:#a6e22e>ID</span>().<span style=color:#a6e22e>Pretty</span>()))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>a</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>PeerHost</span>.<span style=color:#a6e22e>Addrs</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Encapsulate</span>(<span style=color:#a6e22e>hostAddr</span>).<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>NewNop</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dbname</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;iflog-event-kv&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ev</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>iflog</span>.<span style=color:#a6e22e>NewIpfsLog</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>api</span>, <span style=color:#a6e22e>dbname</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>iflog</span>.<span style=color:#a6e22e>EventOptions</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Directory</span>: <span style=color:#a6e22e>rootPath</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Logger</span>:    <span style=color:#a6e22e>log</span>,
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>AnnounceConnect</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>node</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kvdb</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kv</span>.<span style=color:#a6e22e>NewKeyValueDB</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>ev</span>, <span style=color:#a6e22e>log</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Load old data from disk
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ev</span>.<span style=color:#a6e22e>LoadDisk</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kvdb</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;one&#34;</span>, <span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kvdb</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kvdb</span>.<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;bufio&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>icefiredb_crdt_kv</span> <span style=color:#e6db74>&#34;github.com/IceFireDB/icefiredb-crdt-kv/kv&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>badger2</span> <span style=color:#e6db74>&#34;github.com/dgraph-io/badger&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/ipfs/go-datastore/query&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>TODO</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>New</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>icefiredb_crdt_kv</span>.<span style=color:#a6e22e>NewCRDTKeyValueDB</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>icefiredb_crdt_kv</span>.<span style=color:#a6e22e>Config</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>NodeServiceName</span>:     <span style=color:#e6db74>&#34;icefiredb-crdt-kv&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>DataSyncChannel</span>:     <span style=color:#e6db74>&#34;icefiredb-crdt-kv-data&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>NetDiscoveryChannel</span>: <span style=color:#e6db74>&#34;icefiredb-crdt-kv-net&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Namespace</span>:           <span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Logger</span>:              <span style=color:#a6e22e>log</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;&gt; &#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>text</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fields</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Fields</span>(<span style=color:#a6e22e>text</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;&gt; &#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>cmd</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;exit&#34;</span>, <span style=color:#e6db74>&#34;quit&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;get&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;missing key&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>val</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span>, []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>printVal</span>(string(<span style=color:#a6e22e>val</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;put&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;Missing parameters&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>ctx</span>, []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>]), []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>2</span>])))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;delete&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;missing key&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>ctx</span>, []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>])))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;has&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;missing key&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>is</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Has</span>(<span style=color:#a6e22e>ctx</span>, []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>is</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;list&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Query</span>{})
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s =&gt; %v\n&#34;</span>, <span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Key</span>, string(<span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Value</span>)))
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;&gt; &#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;query&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;missing query condition&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#75715e>//fmt.Println(fields[1], len(fields[1]))
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>q</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Query</span>{
</span></span><span style=display:flex><span>				<span style=color:#75715e>//Prefix: fields[1],
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#a6e22e>Filters</span>: []<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Filter</span>{
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>FilterKeyPrefix</span>{
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>Prefix</span>: <span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>					},
</span></span><span style=display:flex><span>				},
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>q</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#75715e>//time.Sleep(time.Second)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s =&gt; %v\n&#34;</span>, <span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Key</span>, string(<span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Value</span>)))
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;&gt; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;connect&#34;</span>: <span style=color:#75715e>// 主动连接
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;Missing connection address&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Connect</span>(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;connection succeeded!&#34;</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;slist&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Store</span>().<span style=color:#a6e22e>Query</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>Query</span>{})
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s =&gt; %v\n&#34;</span>, <span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Key</span>, string(<span style=color:#a6e22e>val</span>.<span style=color:#a6e22e>Value</span>)))
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;&gt; &#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;bquery&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>fields</span>) &lt; <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;missing query condition&#34;</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>DB</span>().<span style=color:#a6e22e>View</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>txn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>badger2</span>.<span style=color:#a6e22e>Txn</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>opts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>badger2</span>.<span style=color:#a6e22e>DefaultIteratorOptions</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>PrefetchSize</span> = <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>it</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>txn</span>.<span style=color:#a6e22e>NewIterator</span>(<span style=color:#a6e22e>opts</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>prefix</span> <span style=color:#f92672>:=</span> []byte(<span style=color:#a6e22e>fields</span>[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Seek</span>(<span style=color:#a6e22e>prefix</span>); <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>ValidForPrefix</span>(<span style=color:#a6e22e>prefix</span>); <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Item</span>()
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>Key</span>()
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>v</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;key=%s, value=%s\n&#34;</span>, <span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>					})
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;blist&#34;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>DB</span>().<span style=color:#a6e22e>View</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>txn</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>badger2</span>.<span style=color:#a6e22e>Txn</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>opts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>badger2</span>.<span style=color:#a6e22e>DefaultIteratorOptions</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>PrefetchSize</span> = <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>it</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>txn</span>.<span style=color:#a6e22e>NewIterator</span>(<span style=color:#a6e22e>opts</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Rewind</span>(); <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Valid</span>(); <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>it</span>.<span style=color:#a6e22e>Item</span>()
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>Key</span>()
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>Value</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>v</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;key=%s, value=%s\n&#34;</span>, <span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>					})
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>printVal</span>(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>printVal</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%v\n&gt; &#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=some-code-reference-sources>Some code reference sources
<a class=anchor href=#some-code-reference-sources>#</a></h2><ul><li><a href=https://github.com/berty/go-ipfs-log>go-ipfs-log</a></li></ul><h2 id=license>License
<a class=anchor href=#license>#</a></h2><p>icefiredb-ipfs-log is under the Apache 2.0 license. See the LICENSE directory for details.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#project-introduction>Project introduction</a></li><li><a href=#features>Features</a></li><li><a href=#installing>Installing</a></li><li><a href=#example>Example</a><ul><li><a href=#example-of-building-a-key-value-database-using-icefiredb-ipfs-log>Example of building a key-value database using icefiredb-ipfs-log</a></li><li><a href=#use-of-key-value-databases>Use of key-value databases</a></li></ul></li><li><a href=#some-code-reference-sources>Some code reference sources</a></li><li><a href=#license>License</a></li></ul></nav></div></aside></main></body></html>